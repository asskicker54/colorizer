# Colorizer

Нейросеть для колоризации черно-белых фотографий

*Выполнил:* Абрамов Илья Олегович, КемГУ

*Руководитель:* кандидат технических наук, доцент
Колесникова Татьяна Геннадьевна


# Запуск

```bash
git clone https://github.com/asskicker54/colorizer
cd colorizer
conda create <<env>> python=3.9
conda activate <<env>>
pip install -r requirements.txt
```

# Notebook
[Обучение на 64 батча](https://github.com/asskicker54/colorizer/blob/main/src/colorizer_gan.ipynb)

[Обучение на 32 батча](https://github.com/asskicker54/colorizer/blob/main/src/32_batch_pc_training.ipynb)

# Оглавление

1. [Понимание бизнес-цели](#понимание-бизнес-цели)
2. [Разведочный анализ](#разведочный-анализ)
3. [Подготовка данных](#подготовка-данных)
4. [Моделирование](#моделирование)
5. [Оценка](#Оценка)


## Понимание бизнес-цели
**Цель** проекта заключается в создании сервиса, использующего глубокое обучение для 
колоризации черно-белых фотографий.

### Метрики оценки
1.	Точность цветопередачи: насколько точно нейросеть подбирает цвета для объектов на фотографии.

2.	Естественность: насколько цвета на фотографии выглядят естественно и реалистично.

3.	Сохранение деталей: насколько хорошо нейросеть сохраняет мелкие детали на фотографии после колоризации.

4.	Время обработки: сколько времени требуется нейросети для колоризации фотографии.

5.	Производительность: сколько фотографий нейросеть может колоризовать за единицу времени.

## Разведочный анализ

[Ссылка на датасет](https://drive.google.com/drive/folders/1VDdLRZAsGp_jAhjZo7w49yMsRf4qS_8d)

Датасет содержит изображения без определенной категории, встречаются пейзажи (как городские, так и природные), фото животных, людей, групп людей.

***Свойства датасета:***

•	изображения размером 150х150 пикселов формата «.jpg»;

•	2791 изображение в датасете;

•	цветные изображения;

Для использования этих данных с GAN, предварительно для каждого изображения будет создаваться парное черно-белое изображение.

## Подготовка данных 

Так как изображения в наборе – цветные, то для обучения модели также понадобятся чёрно-белые (одноканальные) варианты этих изображений. Такие изображения будут создаваться программно. 

Сначала цветные изображения нормализуются для приведения значений пикселов к единому формату, эти изображения помещаются в набор цветных изображений. Затем из них создаются соответствующие одноканальные изображения, которые тоже нормализуется, но помещаются в набор черно-белых изображений.

Таким образом в результате этих преобразований мы получим наборы цветных и соответствующих им черно-белых изображений. Эти наборы в свою очередь будут разделены на обучающую и тестовую выборки для обучения модели.

## Моделирование

**Генеративно-состязательная сеть** (англ. *Generative Adversarial Network*) – алгоритм машинного обучения, построенный на комбинации двух нейронных сетей: генеративная сеть, которая строит приближение распределения данных, и дискриминативная сеть, которая оценивает вероятность того, что данные поступают из тренировочной выборки, а не созданы генеративной сетью.

***Методология:***

•	За один шаг обучения генератор работает единожды, а дискриминатор дважды.

•	Обучение дискриминатора должно проходить таким образом, чтобы вероятность того, что изображение принадлежит к реальным данным было близким к 1, а вероятность того, что изображение создано генератором было близким к 0. Тогда это будет способствовать тому, что генератор будет создавать изображения близкие к тем, что находятся в тренировочных изображениях.

***Генератор:***

•	Генератор принимает на вход черно-белое изображение, а на выходе выдает цветное.

•	Для создания генератора будет использоваться U-Net архитектура, созданная для сегментации, это поможет нам выделять признаки в данных. Эта архитектура состоит из двух частей: кодировщика (сжимающий путь, encoder) и декодера (расширяющий путь, decoder).

•	Кодировщик внутри генератора берет черно-белое изображение и формирует его скрытое представление, то есть создавать низкоразмерное представление, которое содержит ключевые характеристики данных.

•	Декодер внутри генератора использует созданное кодировщиком скрытое представление для генерации новых данных, он использует алгоритмы, направленные на то, чтобы восстанавливать исходные данные из скрытого представления.

•	В качестве функции потерь используется MSE.

***Дискриминатор:***

•	По факту дискриминатор это обычный бинарный классификатор, определяющий вероятность принадлежности входного изображения к настоящим данным.

•	В качестве функции потерь используется Cross-Entropy, так ка это классификатор

***Обучение:***

a.	Каждый шаг обучения генератор создает изображение.

b.	Дискриминатор запускается два раза, для настоящего изображения и для сгенерированного.

c.	Вычисляется функция потерь для каждой части сети.

d.	Используя значения функции потерь, высчитываются градиенты.

e.	Обучение оптимизируется по алгоритму Адама.

f.	Обучение длится 150 эпох.


## Оценка

Спустя 150 эпох обучения с batch_size = 64 удалось достигнуть неплохих результатов.
Проверка на тестовой выборке показала, что модель ещё можно дообучить, чтобы получить результат лучше, однако и сейчас сеть показывает результаты:

![alt](https://sun9-46.userapi.com/impg/E0uM8vIUEhHdEPZ61iEwLzElfI4rRb8tVb01cg/lmHqC4lfyok.jpg?size=856x605&quality=96&sign=e8f4059d58f9dcf29abec5f427394486&type=album)